language: go

go:
  - 1.6.1

env:
  - BUILD_GOOS=darwin
  - BUILD_GOOS=windows
  - BUILD_GOOS=linux

# let us have speedy Docker-based Travis workers
sudo: false

install:
  # Symlink below is needed for Travis CI to work correctly on personal forks of swarm
  - ln -s $HOME/gopath/src/github.com/${TRAVIS_REPO_SLUG///swarm/} $HOME/gopath/src/github.com/docker
  - export GOPATH=${TRAVIS_BUILD_DIR}/Godeps/_workspace:$GOPATH
  - export PATH=${TRAVIS_BUILD_DIR}/Godeps/_workspace/bin:$PATH
  - go get github.com/golang/lint/golint
  - go get github.com/GeertJohan/fgt

script:
  - script/validate-gofmt
  - go vet ./...
  - fgt golint ./...
  # Lint shell files and make sure they are not space indented.
  - fgt find test/ -type f \( -name "*.sh" -or -name "*.bash" -or -name "*.bats" \) -exec grep -Hn -e "^ " {} \;
  - GOOS=${BUILD_GOOS} go build
  - if [[ ${BUILD_GOOS} == 'linux' ]] ; then GOOS=${BUILD_GOOS} go test -v -race ./... ; else true ; fi
